<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[æ¼”ç¤º] æ™ºèƒ½ç”Ÿäº§ç»©æ•ˆæŠ¥å‘Š</title>
    <!-- å¼•å…¥Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥Chart.js ç”¨äºå›¾è¡¨ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- å¼•å…¥ Inter å­—ä½“ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
            background-color: #f1f5f9; /* ä½¿ç”¨æ›´æŸ”å’Œçš„ Slate-100 èƒŒæ™¯è‰² */
        }
        .card {
            background-color: #ffffff;
            border-radius: 0.75rem; /* 12px / rounded-xl */
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.07), 0 4px 6px -4px rgb(0 0 0 / 0.07);
            transition: all 0.3s ease-in-out;
        }
        .card:hover {
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }
        
        /* æ‰“å°æ ·å¼ï¼šéšè—æŒ‰é’®å¹¶ä¼˜åŒ–å¸ƒå±€ */
        @media print {
            .no-print {
                display: none;
            }
            body {
                background-color: #ffffff;
                font-family: 'Inter', 'Noto Sans SC', sans-serif;
            }
            .print-container {
                box-shadow: none;
                margin: 0;
                padding: 0;
                max-width: 100%;
            }
            .card {
                box-shadow: none;
                border: 1px solid #e5e7eb;
                page-break-inside: avoid;
                border-radius: 0.75rem;
            }
            .print-chart-container {
                height: 20rem; /* æ‰“å°æ—¶å›ºå®šå›¾è¡¨é«˜åº¦ */
            }
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto p-4 sm:p-8 max-w-7xl print-container">
        
        <!-- æŠ¥å‘Šå¤´éƒ¨ -->
        <header class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
            <div>
                <h1 class="text-3xl font-bold text-emerald-700">ğŸ· æ™ºèƒ½ç”Ÿäº§ç»©æ•ˆä»ªè¡¨ç›˜ (å…¨åœºç´¯è®¡æ•°æ®)</h1>
                <!-- ä¿®æ”¹ï¼šå®¢æˆ·åç§°æ›¿æ¢ -->
                <p class="text-lg text-gray-700">[æ¼”ç¤º] æ ‡æ†å†œç‰§ç§‘æŠ€æœ‰é™å…¬å¸</p>
                <p class="text-sm text-gray-500 mt-1">æŠ¥å‘Šæ—¥æœŸï¼š2025å¹´11æœˆ10æ—¥</p>
            </div>
            <button onclick="window.print()" class="mt-4 sm:mt-0 no-print bg-emerald-600 text-white px-5 py-2 rounded-lg shadow-md hover:bg-emerald-700 transition duration-300 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m10 0h-8a1 1 0 00-1 1v3a1 1 0 001 1h8a1 1 0 001-1v-3a1 1 0 00-1-1z" />
                </svg>
                æ‰“å°/å¯¼å‡ºPDF
            </button>
        </header>

        <!-- ä»…ç”¨äºæ‰“å°çš„å¤´éƒ¨ -->
        <div class="hidden print:block mb-6 text-center">
             <!-- ä¿®æ”¹ï¼šå®¢æˆ·åç§°æ›¿æ¢ -->
            <h1 class="text-3xl font-bold text-gray-900">[æ¼”ç¤º] æ ‡æ†å†œç‰§ç§‘æŠ€æœ‰é™å…¬å¸ç”Ÿäº§ç»©æ•ˆæŠ¥å‘Š</h1>
            <p class="text-sm text-gray-600 mt-1">æŠ¥å‘Šæ—¥æœŸï¼š2025å¹´11æœˆ10æ—¥</p>
        </div>
        
        <!-- æ–°å¢ï¼šæ•°æ®éšç§å£°æ˜ -->
        <section class="card p-5 mb-8 bg-yellow-50 border border-yellow-300">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                </div>
                <div class="ml-4">
                    <h2 class="text-md font-semibold text-yellow-800">éšç§ä¿æŠ¤ä¸æ•°æ®å£°æ˜</h2>
                    <p class="text-sm text-yellow-700">
                        æœ¬æŠ¥å‘Šæ•°æ®ä¸ºåŸºäºçœŸå®ç”Ÿäº§é€»è¾‘ç”Ÿæˆçš„**è™šæ‹Ÿæ¼”ç¤ºæ•°æ®**ï¼Œæ‰€æœ‰å®¢æˆ·åç§°å‡å·²éšè—ï¼Œæ—¨åœ¨å®‰å…¨å±•ç¤ºAIæŠ¥å‘ŠåŠŸèƒ½ï¼Œä¸ä»£è¡¨ä»»ä½•ç‰¹å®šçŒªåœºçš„çœŸå®è¡¨ç°ã€‚
                    </p>
                </div>
            </div>
        </section>
        
        <!-- æ•°æ®è¯´æ˜ä¸åˆ†æåŸºç¡€ -->
        <section class="card p-6 mb-8 bg-blue-50 border border-blue-200">
            <h2 class="text-xl font-semibold text-blue-800 border-b border-blue-200 pb-3 mb-4">æ•°æ®è¯´æ˜ä¸åˆ†æåŸºç¡€</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-sm">
                <!-- æ—¶é—´èŒƒå›´ -->
                <div class="bg-white p-4 rounded-lg shadow-sm border border-blue-100">
                    <p class="font-medium text-gray-500 uppercase tracking-wider">æ•°æ®æ—¶é—´èŒƒå›´</p>
                    <p class="font-semibold text-gray-700 text-base">2023å¹´æœ« è‡³ 2025å¹´11æœˆ</p>
                    <p class="text-xs text-gray-500 mt-1">æ¶µç›–äº†æ­¤æœŸé—´å†…çš„æ‰€æœ‰ç”Ÿäº§è®°å½•</p>
                </div>
                <!-- åˆ†ææ ·æœ¬ -->
                <div class="bg-white p-4 rounded-lg shadow-sm border border-blue-100">
                    <p class="font-medium text-gray-500 uppercase tracking-wider">åˆ†ææ ·æœ¬</p>
                    <p class="font-semibold text-gray-700 text-base">91ä¸ª å®Œæ•´æ–­å¥¶å‘¨æœŸ</p>
                    <p class="text-xs text-gray-500 mt-1">æ¥æºäºç¬¬ 1ã€2ã€3 èƒæ¬¡çš„æ¯çŒª</p>
                </div>
                <!-- æ•°æ®å†…å®¹ -->
                <div class="bg-white p-4 rounded-lg shadow-sm border border-blue-100">
                    <p class="font-medium text-gray-500 uppercase tracking-wider">æ ¸å¿ƒåˆ†ææ•°æ®</p>
                    <p class="font-semibold text-gray-700 text-base">æ¯çŒªç¹æ®–ä¸äº§æˆ¿æ€§èƒ½</p>
                    <p class="text-xs text-gray-500 mt-1">æ´»ä»”æ•°ã€æ–­å¥¶æ•°ã€æ­»äº¡ç‡ã€æ–­å¥¶ä½“é‡</p>
                </div>
            </div>
            <p class="mt-6 text-xs text-gray-600 bg-blue-100 p-3 rounded-md">
                **é‡è¦æç¤ºï¼š** æ­¤æŠ¥å‘Šåˆ†æçš„æ˜¯çŒªç¾¤è‡ª2023å¹´æœ«ä»¥æ¥**æŒ‰èƒæ¬¡**ç´¯ç§¯çš„**é•¿æœŸç»“æ„æ€§è¡¨ç°**ã€‚å®ƒæ—¨åœ¨å‘ç°æ ¹æœ¬æ€§çš„ç®¡ç†é—®é¢˜ï¼ˆå¦‚é«˜èƒæ¬¡æ€§èƒ½ä¸‹é™ï¼‰ã€‚
                <br>å¦‚éœ€è¯„ä¼°**çŸ­æœŸè¿è¥è¡¨ç°**ï¼Œå»ºè®®ä½¿ç”¨æœˆåº¦æ•°æ®ï¼ˆè‹¥æœ‰ï¼‰è¿›è¡Œç¯æ¯”åˆ†æã€‚
            </p>
        </section>

        <!-- æ ¸å¿ƒæ•°æ®æ¦‚è§ˆ -->
        <section class="mb-8">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">å…³é”®æŒ‡æ ‡æ¦‚è§ˆ (èƒæ¬¡ 1-3 å¹³å‡)</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- å¡ç‰‡1: å¹³å‡çªæ´»ä»”æ•° -->
                <div class="card p-6 flex items-start">
                    <div class="flex-shrink-0 bg-emerald-100 text-emerald-600 rounded-lg p-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <div class="ml-5">
                        <p class="text-sm font-medium text-gray-500 uppercase tracking-wider">å¹³å‡çªæ´»ä»”æ•°</p>
                        <p class="text-4xl font-bold text-emerald-600">15.27 <span class="text-lg font-medium text-gray-600">å¤´</span></p>
                        <p class="text-sm text-gray-500 mt-1">é«˜äº§æ½œåŠ›çªå‡º</p>
                    </div>
                </div>
                <!-- å¡ç‰‡2: å¹³å‡æ–­å¥¶æ•° -->
                <div class="card p-6 flex items-start">
                    <div class="flex-shrink-0 bg-blue-100 text-blue-600 rounded-lg p-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-2.121M17 20v-2m-8-3a4 4 0 100-8 4 4 0 000 8zm0 0c1.657 0 3-1.79 3-4s-1.343-4-3-4S6 3.79 6 6s1.343 4 3 4zm6 5H3a1 1 0 00-1 1v3a1 1 0 001 1h12a1 1 0 001-1v-3a1 1 0 00-1-1z" />
                        </svg>
                    </div>
                    <div class="ml-5">
                        <p class="text-sm font-medium text-gray-500 uppercase tracking-wider">å¹³å‡æ–­å¥¶æ•°</p>
                        <p class="text-4xl font-bold text-blue-600">13.14 <span class="text-lg font-medium text-gray-600">å¤´</span></p>
                        <p class="text-sm text-gray-500 mt-1">äº§æˆ¿ä»æœ‰æŸå¤±</p>
                    </div>
                </div>
                <!-- å¡ç‰‡3: çªæ­»äº¡ç‡ -->
                <div class="card p-6 flex items-start">
                    <div class="flex-shrink-0 bg-red-100 text-red-600 rounded-lg p-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                        </svg>
                    </div>
                    <div class="ml-5">
                        <p class="text-sm font-medium text-gray-500 uppercase tracking-wider">çªæ­»äº¡ç‡</p>
                        <p class="text-4xl font-bold text-red-600">13.93 <span class="text-lg font-medium text-gray-600">%</span></p>
                        <p class="text-sm text-gray-500 mt-1">æ ¸å¿ƒæ”¹è¿›ç‚¹</p>
                    </div>
                </div>
                <!-- å¡ç‰‡4: æ–­å¥¶å‡é‡ -->
                <div class="card p-6 flex items-start">
                    <div class="flex-shrink-0 bg-yellow-100 text-yellow-600 rounded-lg p-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2" />
                        </svg>
                    </div>
                    <div class="ml-5">
                        <p class="text-sm font-medium text-gray-500 uppercase tracking-wider">ä»”çŒªæ–­å¥¶å‡é‡</p>
                        <p class="text-4xl font-bold text-yellow-700">7.08 <span class="text-lg font-medium text-gray-600">kg</span></p>
                        <p class="text-sm text-gray-500 mt-1">æœ‰æå‡ç©ºé—´</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- æ ¸å¿ƒKPIæ€»è§ˆ -->
        <section class="card p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-900 border-b pb-3 mb-4">ä¸€ã€ è¯¦ç»†ç»©æ•ˆåˆ†è§£ (æŒ‰èƒæ¬¡)</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ ¸å¿ƒæŒ‡æ ‡ (KPI)</th>
                            <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">èƒæ¬¡ 1</th>
                            <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">èƒæ¬¡ 2</th>
                            <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">èƒæ¬¡ 3</th>
                            <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">æ€»ä½“å¹³å‡ (èƒæ¬¡ 1-3)</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800">å®Œæˆå‘¨æœŸæ•° (æ ·æœ¬é‡)</td>
                            <td class="px-6 py-4 text-center text-sm font-bold text-gray-700">40</td>
                            <td class="px-6 py-4 text-center text-sm font-bold text-gray-700">28</td>
                            <td class="px-6 py-4 text-center text-sm font-bold text-gray-700">23</td>
                            <td class="px-6 py-4 text-center text-sm font-bold text-blue-700">91</td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800">å¹³å‡çªæ´»ä»”æ•° (NbNv)</td>
                            <td class="px-6 py-4 text-center text-sm">14.15</td>
                            <td class="px-6 py-4 text-center text-sm font-bold text-emerald-700">15.71</td>
                            <td class="px-6 py-4 text-center text-sm font-bold text-emerald-700">15.96</td>
                            <td class="px-6 py-4 text-center text-sm font-bold text-emerald-700">15.27</td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800">å¹³å‡æ–­å¥¶ä»”çŒªæ•° (NbSev)</td>
                            <td class="px-6 py-4 text-center text-sm">12.95</td>
                            <td class="px-6 py-4 text-center text-sm font-bold text-emerald-700">13.57</td>
                            <td class="px-6 py-4 text-center text-sm">12.74</td>
                            <td class="px-6 py-4 text-center text-sm font-bold">13.14</td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800">çªæ­»äº¡ç‡ (%)</td>
                            <td class="px-6 py-4 text-center text-sm font-bold text-yellow-600">8.5%</td>
                            <td class="px-6 py-4 text-center text-sm font-bold text-red-600">13.75%</td>
                            <td class="px-6 py-4 text-center text-sm font-bold text-red-700">20.17%</td>
                            <td class="px-6 py-4 text-center text-sm font-bold text-red-600">13.93%</td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800">å¹³å‡æ–­å¥¶æ—¥é¾„ (AgeSev)</td>
                            <td class="px-6 py-4 text-center text-sm">24.1 å¤©</td>
                            <td class="px-6 py-4 text-center text-sm">27.2 å¤©</td>
                            <td class="px-6 py-4 text-center text-sm font-bold text-red-600">30.5 å¤©</td>
                            <td class="px-6 py-4 text-center text-sm">27.0 å¤©</td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800">å¹³å‡çªæ–­å¥¶æ€»é‡ (PdsSev)</td>
                            <td class="px-6 py-4 text-center text-sm font-bold">94.6 kg</td>
                            <td class="px-6 py-4 text-center text-sm">94.4 kg</td>
                            <td class="px-6 py-4 text-center text-sm font-bold text-red-600">87.0 kg</td>
                            <td class="px-6 py-4 text-center text-sm">92.6 kg</td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800">å¹³å‡ä»”çŒªæ–­å¥¶å‡é‡</td>
                            <td class="px-6 py-4 text-center text-sm font-bold text-emerald-700">7.30 kg</td>
                            <td class="px-6 py-4 text-center text-sm">6.96 kg</td>
                            <td class="px-6 py-4 text-center text-sm font-bold text-red-700">6.84 kg</td>
                            <td class="px-6 py-4 text-center text-sm font-bold">7.08 kg</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- è¿‘æœŸè¶‹åŠ¿ -->
        <section class="card p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-900 border-b pb-3 mb-4">äºŒã€ è¿‘æœŸç”Ÿäº§è¶‹åŠ¿ (åŸºäºç´¯è®¡æ•°æ®æ¨ç®—)</h2>
             <p class="text-sm text-gray-600 mb-4">
                æ³¨æ„ï¼šç”±äºæ•°æ®ä¸ºå…¨åœºç´¯è®¡ï¼Œæœˆåº¦å¯¹æ¯”ä»…ä¸ºæ ¹æ®æœ€è¿‘äº‹ä»¶æ—¥æœŸçš„ä¼°ç®—ï¼Œæœ€å‡†ç¡®çš„åˆ†æè¯·å‚è§ä¸‹æ–¹çš„â€œæŒ‰èƒæ¬¡å¯¹æ¯”â€ã€‚
            </p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- æ–­å¥¶è¶‹åŠ¿ -->
                <div>
                    <h3 class="text-md font-semibold text-gray-700 mb-2">æ–­å¥¶è¶‹åŠ¿ (ä¼°ç®— 9æœˆ vs 8æœˆ)</h3>
                    <table class="min-w-full divide-y divide-gray-200 border rounded-lg overflow-hidden">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">ç»´åº¦</th>
                                <th class="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase">8æœˆ (ä¼°ç®—)</th>
                                <th class="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase">9æœˆ (ä¼°ç®—)</th>
                                <th class="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase">è¶‹åŠ¿</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td class="px-4 py-2 text-sm">æ–­å¥¶çªæ•°</td>
                                <td class="px-4 py-2 text-center text-sm">9</td>
                                <td class="px-4 py-2 text-center text-sm">11</td>
                                <td class="px-4 py-2 text-center text-lg font-bold text-emerald-600">â†—</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-2 text-sm">å¹³å‡æ–­å¥¶æ•°/çª</td>
                                <td class="px-4 py-2 text-center text-sm">10.78</td>
                                <td class="px-4 py-2 text-center text-sm">10.91</td>
                                <td class="px-4 py-2 text-center text-lg font-bold text-gray-500">â†’</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-2 text-sm">å¹³å‡ä»”çŒªå‡é‡</td>
                                <td class="px-4 py-2 text-center text-sm">6.95 kg</td>
                                <td class="px-4 py-2 text-center text-sm">7.38 kg</td>
                                <td class="px-4 py-2 text-center text-lg font-bold text-emerald-600">â†—</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- äº§ä»”è¶‹åŠ¿ -->
                <div>
                    <h3 class="text-md font-semibold text-gray-700 mb-2">äº§ä»”è¶‹åŠ¿ (ä¼°ç®— 10æœˆ vs 9æœˆ)</h3>
                    <table class="min-w-full divide-y divide-gray-200 border rounded-lg overflow-hidden">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">ç»´åº¦</th>
                                <th class="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase">9æœˆ (ä¼°ç®—)</th>
                                <th class="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase">10æœˆ (ä¼°ç®—)</th>
                                <th class="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase">è¶‹åŠ¿</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td class="px-4 py-2 text-sm">äº§ä»”çªæ•°</td>
                                <td class="px-4 py-2 text-center text-sm">7</td>
                                <td class="px-4 py-2 text-center text-sm">15</td>
                                <td class="px-4 py-2 text-center text-lg font-bold text-emerald-600">â†—</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-2 text-sm">å¹³å‡çªæ´»ä»”æ•°</td>
                                <td class="px-4 py-2 text-center text-sm">14.43</td>
                                <td class="px-4 py-2 text-center text-sm font-bold text-red-600">12.53</td>
                                <td class="px-4 py-2 text-center text-lg font-bold text-red-600">â†˜</td>
                            </tr>
                             <tr>
                                <td class="px-4 py-2 text-sm">&nbsp;</td>
                                <td class="px-4 py-2 text-center text-sm">&nbsp;</td>
                                <td class="px-4 py-2 text-center text-sm">&nbsp;</td>
                                <td class="px-4 py-2 text-center text-lg">&nbsp;</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <p class="text-sm text-gray-600 mt-4">
                **è¶‹åŠ¿å°ç»“ï¼š** 9æœˆçš„æ–­å¥¶æˆç»©ï¼ˆä»”çŒªå‡é‡ï¼‰æœ‰æ‰€æ”¹å–„ã€‚ä½†10æœˆæ–°äº§ä»”çš„çªæ´»ä»”æ•°ï¼ˆ12.53å¤´ï¼‰ç›¸æ¯”9æœˆï¼ˆ14.43å¤´ï¼‰æœ‰æ˜æ˜¾ä¸‹é™ï¼Œéœ€å…³æ³¨ï¼ˆ6-7æœˆï¼‰çš„é…ç§æƒ…å†µã€‚
            </p>
        </section>

        <!-- KPI å¯è§†åŒ–å›¾è¡¨ -->
        <section class="mb-6 card">
            <h2 class="text-xl font-semibold text-gray-900 border-b pb-3 mb-4 p-6">ä¸‰ã€ æ ¸å¿ƒé—®é¢˜å¯è§†åŒ– (æŒ‰èƒæ¬¡å¯¹æ¯”)</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 p-6 pt-0">
                <!-- å›¾è¡¨1: äº§ä»”æ€§èƒ½ -->
                <div class="bg-gray-50 p-4 rounded-lg border print-chart-container h-80">
                    <h3 class="text-md font-semibold text-gray-800 mb-2 text-center">äº§ä»”æ€§èƒ½ (çªæ´»ä»”æ•°)</h3>
                    <canvas id="litterSizeChart"></canvas>
                </div>
                <!-- å›¾è¡¨2: çªæ­»äº¡ç‡ -->
                <div class="bg-gray-50 p-4 rounded-lg border print-chart-container h-80">
                    <h3 class="text-md font-semibold text-gray-800 mb-2 text-center">çªæ­»äº¡ç‡ (%)</h3>
                    <canvas id="mortalityChart"></canvas>
                </div>
                <!-- å›¾è¡¨3: æ–­å¥¶å‡é‡ -->
                <div class="bg-gray-50 p-4 rounded-lg border print-chart-container h-80">
                    <h3 class="text-md font-semibold text-gray-800 mb-2 text-center">ä»”çŒªæ–­å¥¶å‡é‡ (kg)</h3>
                    <canvas id="weanWeightChart"></canvas>
                </div>
                <!-- æ½œåŠ›æ”¹è¿›åŒºé—´ -->
                <div class="bg-gray-50 p-4 rounded-lg border print-chart-container flex flex-col justify-center items-center h-80">
                    <h3 class="text-md font-semibold text-gray-800 mb-2 text-center">æ½œåŠ›æ”¹è¿›åŒºé—´ (ä»”çŒªå‡é‡)</h3>
                    <div class="text-center p-6">
                        <div class="text-6xl font-bold text-red-600">52.7%</div>
                        <p class="text-lg font-medium text-gray-800 mt-2">çš„çªå¹³å‡æ–­å¥¶å‡é‡**ä½äº 7.0 kg**</p>
                        <p class="text-sm text-gray-600 mt-2">(åŸºäº91ä¸ªæœ‰æ•ˆæ–­å¥¶çªæ•°æ®)</p>
                        <div class="w-full bg-gray-200 rounded-full h-4 mt-4 overflow-hidden">
                            <div class="bg-red-600 h-4 rounded-full" style="width: 52.7%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- æ€»ç»“ä¸å»ºè®® -->
        <section class="card p-6">
            <h2 class="text-xl font-semibold text-gray-900 border-b pb-3 mb-4">å››ã€ æ€»ç»“ä¸ä¸‹é˜¶æ®µå»ºè®®</h2>
            <!-- æ ¸å¿ƒç»“è®º - ä¸ºJSè„šæœ¬æ·»åŠ ID -->
            <div id="coreConclusions" class="mb-6 p-4 bg-emerald-50 border-l-4 border-emerald-400 rounded-r-lg">
                <h3 class="text-lg font-semibold text-emerald-800 mb-2">æ ¸å¿ƒç»“è®º (æŒ‰èƒæ¬¡ç»“æ„åˆ†æ)</h3>
                <p class="text-sm text-gray-700 leading-relaxed">
                    è´µå¸æ¯çŒªç¾¤å…·å¤‡**æé«˜çš„äº§ä»”æ½œåŠ›**ï¼ˆèƒæ¬¡ 2-3 æ´»ä»”æ•°è¿‘ 16 å¤´ï¼‰ã€‚ä½†è¿™ä¸€æ½œåŠ›è¢«ä¸¤å¤§**ç»“æ„æ€§é—®é¢˜**ä¸¥é‡é™åˆ¶ï¼š
                    <br>1. **é«˜èƒæ¬¡äº§æˆ¿æ­»äº¡ç‡é«˜ï¼š** èƒæ¬¡ 3 çš„çªæ­»äº¡ç‡é«˜è¾¾ **20.17%**ï¼Œå¯¼è‡´å¹³å‡æ–­å¥¶æ•°ï¼ˆ12.74å¤´ï¼‰ç”šè‡³ä½äºèƒæ¬¡ 1ï¼ˆ12.95å¤´ï¼‰ï¼Œé«˜äº§ä»”ä¼˜åŠ¿è¢«å®Œå…¨æµªè´¹ã€‚
                    <br>2. **é«˜èƒæ¬¡æ³Œä¹³æ€§èƒ½ä½ä¸‹ï¼š** èƒæ¬¡ 3 çš„æ¯çŒª**é¥²å–‚æ—¶é—´æœ€é•¿**ï¼ˆ30.5å¤©ï¼‰ï¼Œä½†äº§å‡ºçš„**ä»”çŒªå‡é‡å´æ˜¯æœ€ä½çš„**ï¼ˆ6.84 kgï¼‰ã€‚è¿™è¡¨æ˜æ¯çŒªåœ¨æ³Œä¹³åæœŸå·²æ— æ³•æ»¡è¶³ä»”çŒªç”Ÿé•¿éœ€æ±‚ï¼Œæ˜¯ä¸¥é‡çš„ç”Ÿäº§ä½æ•ˆã€‚
                </p>
            </div>

            <!-- æ ‡é¢˜å’Œæ–°å¢çš„AIæŒ‰é’® -->
            <div class="flex items-center justify-between mb-3">
                <h3 class="text-lg font-semibold text-gray-800">ä¸‹é˜¶æ®µç®¡ç†å»ºè®® (Next Steps)</h3>
                <button id="generateMemoBtn" class="no-print bg-emerald-500 text-white px-4 py-2 rounded-lg shadow-sm hover:bg-emerald-600 transition duration-300 text-sm flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1.5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.707-10.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L9.414 11H13a1 1 0 100-2H9.414l1.293-1.293z" clip-rule="evenodd" />
                    </svg>
                    âœ¨ æ™ºèƒ½ç”Ÿæˆå›¢é˜Ÿå‘¨æŠ¥
                </button>
            </div>
            
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200 border">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase w-[15%]">ä¼˜å…ˆçº§</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase w-[20%]">é¢†åŸŸ</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase w-[35%]">å»ºè®®æªæ–½</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase w-[30%]">ç›®çš„</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <tr class="hover:bg-gray-50">
                            <td class="px-4 py-3">
                                <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                                    æœ€ç´§æ€¥
                                </span>
                            </td>
                            <td class="px-4 py-3 text-sm font-bold text-gray-700">æ•°æ®ç®¡ç†</td>
                            <td class="px-4 py-3 text-sm text-gray-700">å®¡æŸ¥è¿‘æœŸçªé‡è®°å½•ä¸­çš„æç«¯å¼‚å¸¸å€¼ï¼ˆå¦‚ 7kg çªé‡ï¼‰ï¼Œå¹¶å¯¹æ‰€æœ‰å‘˜å·¥è¿›è¡Œ `PdsSev` (çªæ€»é‡) å½•å…¥æ ‡å‡†çš„å†åŸ¹è®­ã€‚</td>
                            <td class="px-4 py-3 text-sm text-gray-700">ç¡®ä¿æ•°æ®å‡†ç¡®æ€§ï¼Œè¿™æ˜¯æ‰€æœ‰ç”Ÿäº§å†³ç­–çš„åŸºç¡€ã€‚</td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="px-4 py-3">
                                <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                                    é«˜ä¼˜å…ˆçº§
                                </span>
                            </td>
                            <td class="px-4 py-3 text-sm font-bold text-gray-700">äº§æˆ¿ç®¡ç†</td>
                            <td class="px-4 py-3 text-sm text-gray-700">é’ˆå¯¹é«˜äº§ä»”ï¼ˆæ´»ä»”æ•° $\ge$ 15ï¼‰çš„**é«˜èƒæ¬¡æ¯çŒª**ï¼Œå¿…é¡»æ‰§è¡Œ**å¯„å…»**æˆ–**åˆ†æ‰¹å“ºä¹³**ã€‚å¢åŠ äº§æˆ¿å·¡æ é¢‘ç‡ï¼Œé˜²å‹æ­»ã€‚</td>
                            <td class="px-4 py-3 text-sm text-gray-700">æ”»åšé«˜èƒæ¬¡æ­»äº¡ç‡ (ç›®æ ‡ <10%)ã€‚</td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="px-4 py-3">
                                <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                                    é«˜ä¼˜å…ˆçº§
                                </span>
                            </td>
                            <td class="px-4 py-3 text-sm font-bold text-gray-700">è¥å…»ç­–ç•¥</td>
                            <td class="px-4 py-3 text-sm text-gray-700">
                                **é‡æ–°è¯„ä¼°èƒæ¬¡ 3+ æ¯çŒªçš„æ³Œä¹³æœŸé¥²æ–™é…æ–¹**ï¼Œå¯èƒ½éœ€æé«˜èƒ½é‡å’Œæ°¨åŸºé…¸æµ“åº¦ã€‚æ£€æŸ¥é«˜èƒæ¬¡æ¯çŒªçš„é‡‡é£Ÿé‡å’Œé¥®æ°´æµé‡ã€‚
                                <!-- æ–°å¢çš„AIæŒ‰é’® -->
                                <button id="generateNutritionBtn" class="no-print mt-2 bg-blue-500 text-white px-3 py-1.5 rounded-md shadow-sm hover:bg-blue-600 transition duration-300 text-xs flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1.5" viewBox="0 0 20 20" fill="currentColor">
                                      <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                                    </svg>
                                    âœ¨ AIåˆ†æè¥å…»æ–¹æ¡ˆ
                                </button>
                            </td>
                            <td class="px-4 py-3 text-sm text-gray-700">æå‡é«˜èƒæ¬¡æ³Œä¹³æ€§èƒ½ï¼Œæé«˜ä»”çŒªå‡é‡ (ç›®æ ‡ >7.0kg)ã€‚</td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="px-4 py-3">
                                <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                                    æŒç»­ä¼˜åŒ–
                                </span>
                            </td>
                            <td class="px-4 py-3 text-sm font-bold text-gray-700">çŒªç¾¤ä¼˜åŒ–</td>
                            <td class="px-4 py-3 text-sm text-gray-700">å»ºç«‹æ¸…æ™°çš„**ä½æ•ˆæ¯çŒªæ·˜æ±°æ ‡å‡†**ï¼ˆä¾‹å¦‚ï¼šè¿ç»­èƒæ¬¡äº§ä»”æ€§èƒ½ä½ä¸‹ã€æœ¨ä¹ƒä¼Š/æ­»èƒç‡è¿‡é«˜ï¼‰ï¼Œå¹¶åšå†³æ‰§è¡Œã€‚</td>
                            <td class="px-4 py-3 text-sm text-gray-700">ä¼˜åŒ–ç¾¤ä½“ç»“æ„ï¼Œæ·˜æ±°ç”Ÿäº§åŠ›ä½ä¸‹çš„æ¯çŒªã€‚</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

    </div>

    <!-- AI Modal (æ–°å¢) -->
    <div id="aiModal" class="no-print fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden p-4">
        <div class="card w-full max-w-2xl max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-5 border-b border-gray-200">
                <h3 id="modalTitle" class="text-xl font-semibold text-emerald-700">AI æ™ºèƒ½åˆ†æç»“æœ</h3>
                <button id="closeModalBtn" class="text-gray-400 hover:text-gray-600 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div id="modalContent" class="p-6 overflow-y-auto text-gray-700 leading-relaxed space-y-4">
                <!-- AIç”Ÿæˆçš„å†…å®¹å°†æ³¨å…¥è¿™é‡Œ -->
            </div>
            <div class="p-4 bg-gray-50 border-t text-right rounded-b-xl">
                 <button id="copyModalBtn" class="bg-blue-500 text-white px-4 py-2 rounded-lg shadow-sm hover:bg-blue-600 transition duration-300 text-sm">
                    å¤åˆ¶å†…å®¹
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Spinner (æ–°å¢) -->
    <div id="loadingSpinner" class="no-print fixed inset-0 bg-white bg-opacity-90 flex flex-col items-center justify-center z-[100] hidden">
        <svg class="animate-spin h-12 w-12 text-emerald-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <p class="text-lg font-medium text-emerald-700 mt-4">AI æ­£åœ¨åˆ†ææ‚¨çš„æ•°æ®ï¼Œè¯·ç¨å€™...</p>
    </div>

    <!-- è„šæœ¬ç§»åŠ¨åˆ° body æœ«å°¾ -->
    <script>
        // å›¾è¡¨æ¸²æŸ“è„šæœ¬
        (function() {
            // ç¡®ä¿ DOM å…ƒç´ å­˜åœ¨åå†æ‰§è¡Œ
            const ctx1 = document.getElementById('litterSizeChart');
            const ctx2 = document.getElementById('mortalityChart');
            const ctx3 = document.getElementById('weanWeightChart');

            if (!ctx1 || !ctx2 || !ctx3) {
                // å¦‚æœç”»å¸ƒä¸å­˜åœ¨ï¼Œåˆ™ä¸æ‰§è¡Œå›¾è¡¨æ¸²æŸ“
                return;
            }

            const labels = ['èƒæ¬¡ 1', 'èƒæ¬¡ 2', 'èƒæ¬¡ 3', 'èƒæ¬¡ 4'];
            const kpiData = {
                litterSize: [14.15, 15.71, 15.96, 10.25],
                mortality: [8.5, 13.75, 20.17, 0.0],
                // èƒæ¬¡4å‡é‡è®¡ç®—ï¼š(68/10 + 74/11 + 80/12 + 55/8) / 4 = (6.8 + 6.73 + 6.67 + 6.87) / 4 = 6.77
                weanWeight: [7.30, 6.96, 6.84, 6.77] 
            };
            
            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false, // å…è®¸å›¾è¡¨åœ¨å®¹å™¨å†…è°ƒæ•´å¤§å°
                plugins: {
                    legend: { display: false }
                }
            };

            // 1. äº§ä»”æ€§èƒ½ (çªæ´»ä»”æ•°) - æŸ±çŠ¶å›¾
            new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'å¹³å‡çªæ´»ä»”æ•° (NbNv)',
                        data: kpiData.litterSize,
                        backgroundColor: [
                            'rgba(54, 162, 235, 0.6)',
                            'rgba(16, 185, 129, 0.6)', // emerald
                            'rgba(16, 185, 129, 0.8)', // emerald
                            'rgba(255, 159, 64, 0.6)'
                        ],
                        borderColor: [
                            'rgba(54, 162, 235, 1)',
                            'rgba(16, 185, 129, 1)',
                            'rgba(16, 185, 129, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    ...chartOptions,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'å¤´ (Head)' }
                        }
                    }
                }
            });

            // 2. çªæ­»äº¡ç‡ (%) - æŠ˜çº¿å›¾
            new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: labels.slice(0, 3), // èƒæ¬¡4æ•°æ®é‡å°‘ï¼Œä¸æ˜¾ç¤ºæ­»äº¡ç‡
                    datasets: [{
                        label: 'çªæ­»äº¡ç‡ (%)',
                        data: kpiData.mortality.slice(0, 3),
                        fill: false,
                        borderColor: 'rgba(239, 68, 68, 1)',
                        backgroundColor: 'rgba(239, 68, 68, 0.8)',
                        tension: 0.1,
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    ...chartOptions,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'ç™¾åˆ†æ¯” (%)' }
                        }
                    }
                }
            });

            // 3. ä»”çŒªæ–­å¥¶å‡é‡ (kg) - æŸ±çŠ¶å›¾
            new Chart(ctx3, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'å¹³å‡ä»”çŒªæ–­å¥¶å‡é‡ (kg)',
                        data: kpiData.weanWeight,
                        backgroundColor: [
                            'rgba(16, 185, 129, 0.6)', // emerald
                            'rgba(245, 158, 11, 0.6)', // amber
                            'rgba(239, 68, 68, 0.6)', // èƒæ¬¡3 çº¢è‰²
                            'rgba(239, 68, 68, 0.4)'  // èƒæ¬¡4 æµ…çº¢
                        ],
                        borderColor: [
                            'rgba(16, 185, 129, 1)',
                            'rgba(245, 158, 11, 1)',
                            'rgba(239, 68, 68, 1)',
                            'rgba(239, 68, 68, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    ...chartOptions,
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 6, // ä»6kgå¼€å§‹ï¼Œæ›´æ˜æ˜¾
                            title: { display: true, text: 'å…¬æ–¤ (kg)' }
                        }
                    }
                }
            });
        })(); // ä½¿ç”¨ IIFE ç«‹å³æ‰§è¡Œ
    </script>

    <!-- æ–°å¢: Gemini API è°ƒç”¨è„šæœ¬ -->
    <script>
        (function() {
            // API é…ç½® (è¯·æ³¨æ„ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒAPIå¯†é’¥ä¸åº”æš´éœ²åœ¨å®¢æˆ·ç«¯)
            const apiKey = ""; // ç•™ç©ºï¼Œå°†ç”± Canvas è¿è¡Œæ—¶æä¾›
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

            // è·å– Modal å’Œ Loading çš„ DOM å…ƒç´ 
            const modal = document.getElementById('aiModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const copyModalBtn = document.getElementById('copyModalBtn');
            const loadingSpinner = document.getElementById('loadingSpinner');

            // è·å–æŒ‰é’®
            const generateMemoBtn = document.getElementById('generateMemoBtn');
            const generateNutritionBtn = document.getElementById('generateNutritionBtn');
            
            // ç¡®ä¿æŒ‰é’®å­˜åœ¨
            if (!generateMemoBtn || !generateNutritionBtn || !modal || !closeModalBtn || !copyModalBtn || !loadingSpinner) {
                console.warn("æŠ¥å‘Šçš„ AI äº¤äº’å…ƒç´ æœªèƒ½å®Œå…¨åŠ è½½ã€‚");
                return;
            }

            // --- å¸®åŠ©å‡½æ•° ---

            /**
             * æ˜¾ç¤º/éšè— Loading åŠ¨ç”»
             * @param {boolean} isLoading æ˜¯å¦æ˜¾ç¤º
             */
            function showLoading(isLoading) {
                if (isLoading) {
                    loadingSpinner.classList.remove('hidden');
                } else {
                    loadingSpinner.classList.add('hidden');
                }
            }

            /**
             * æ˜¾ç¤º Modal
             * @param {string} title æ ‡é¢˜
             * @param {string} content HTML å†…å®¹
             */
            function showModal(title, content) {
                modalTitle.textContent = title;
                modalContent.innerHTML = content;
                modal.classList.remove('hidden');
            }

            /**
             * éšè— Modal
             */
            function hideModal() {
                modal.classList.add('hidden');
            }

            /**
             * å¤åˆ¶ Modal å†…å®¹åˆ°å‰ªè´´æ¿
             */
            function copyToClipboard() {
                // åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„textareaæ¥å¤„ç†HTMLåˆ°çº¯æ–‡æœ¬çš„è½¬æ¢
                const tempEl = document.createElement('textarea');
                // è½¬æ¢ <br> ä¸ºæ¢è¡Œç¬¦
                let textContent = modalContent.innerHTML.replace(/<br\s*[\/]?>/gi, "\n");
                // ç§»é™¤å…¶ä»–HTMLæ ‡ç­¾
                textContent = textContent.replace(/<[^>]+>/g, '');
                // ç§»é™¤å¤šä½™çš„ç©ºç™½
                textContent = textContent.replace(/&nbsp;/g, ' ');
                textContent = textContent.replace(/\s+/g, ' ').trim();
                
                tempEl.value = textContent;
                document.body.appendChild(tempEl);
                tempEl.select();
                try {
                    document.execCommand('copy'); // ä½¿ç”¨ execCommand ä»¥å…¼å®¹iFrame
                    copyModalBtn.textContent = 'å¤åˆ¶æˆåŠŸ!';
                    setTimeout(() => { copyModalBtn.textContent = 'å¤åˆ¶å†…å®¹'; }, 2000);
                } catch (err) {
                    console.error('å¤åˆ¶å¤±è´¥: ', err);
                    copyModalBtn.textContent = 'å¤åˆ¶å¤±è´¥';
                }
                document.body.removeChild(tempEl);
            }


            /**
             * å¸¦æŒ‡æ•°é€€é¿çš„ Fetch API è°ƒç”¨
             * @param {number} maxRetries æœ€å¤§é‡è¯•æ¬¡æ•°
             */
            async function fetchWithBackoff(url, options, maxRetries = 5) {
                let attempt = 0;
                while (attempt < maxRetries) {
                    try {
                        const response = await fetch(url, options);
                        if (response.ok) {
                            return await response.json();
                        }
                        // åªå¯¹ç‰¹å®šçš„å¯é‡è¯•é”™è¯¯è¿›è¡Œé€€é¿
                        if ([429, 500, 503].includes(response.status)) {
                            throw new Error(`Retryable error: ${response.status}`);
                        } else {
                            // å¯¹äº 400 ç­‰å®¢æˆ·ç«¯é”™è¯¯ï¼Œç›´æ¥æŠ›å‡º
                            const errorData = await response.json();
                            throw new Error(`Non-retryable error: ${response.status} - ${errorData.error?.message || 'Unknown error'}`);
                        }
                    } catch (error) {
                        attempt++;
                        if (attempt >= maxRetries) {
                            throw error; // è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ŒæŠ›å‡ºæœ€ç»ˆé”™è¯¯
                        }
                        const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
                        // ä¸åœ¨æ§åˆ¶å°æ‰“å°é‡è¯•æ—¥å¿—
                        await new Promise(resolve => setTimeout(resolve, delay));
                    }
                }
            }
            
            /**
             * è¥å…»æ–¹æ¡ˆçš„ JSON Schema
             */
            const nutritionSchema = {
                type: "OBJECT",
                properties: {
                    "key_nutrient_adjustments": {
                        "type": "ARRAY",
                        "items": { "type": "STRING" },
                        "description": "å…³é”®è¥å…»è°ƒæ•´å»ºè®® (ä¾‹å¦‚: 'æé«˜å‡€èƒ½è‡³ X Mj/kg')"
                    },
                    "feeding_strategy": {
                        "type": "ARRAY",
                        "items": { "type": "STRING" },
                        "description": "é¥²å–‚ç­–ç•¥å»ºè®® (ä¾‹å¦‚: 'ä»äº§åç¬¬5å¤©å¼€å§‹è‡ªç”±é‡‡é£Ÿ')"
                    },
                    "water_management": {
                        "type": "ARRAY",
                        "items": { "type": "STRING" },
                        "description": "é¥®æ°´ç®¡ç†å»ºè®® (ä¾‹å¦‚: 'ç¡®ä¿æ°´æµé‡ä¸ä½äº 2L/åˆ†é’Ÿ')"
                    }
                },
                "propertyOrdering": ["key_nutrient_adjustments", "feeding_strategy", "water_management"]
            };

            /**
             * è°ƒç”¨ Gemini API çš„ä¸»å‡½æ•°
             * @param {string} userQuery - ç”¨æˆ·çš„æç¤º
             * @param {string} systemInstruction - ç³»ç»ŸæŒ‡ä»¤
             * @param {boolean} isJson - æ˜¯å¦è¯·æ±‚ JSON å“åº”
             * @param {object} schema - (å¯é€‰) JSON schema
             */
            async function callGeminiAPI(userQuery, systemInstruction, isJson = false, schema = null) {
                showLoading(true);

                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    systemInstruction: {
                        parts: [{ text: systemInstruction }]
                    },
                };

                if (isJson && schema) {
                    payload.generationConfig = {
                        responseMimeType: "application/json",
                        responseSchema: schema
                    };
                }

                try {
                    const result = await fetchWithBackoff(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (result && result.candidates && result.candidates[0].content) {
                        const textResponse = result.candidates[0].content.parts[0].text;
                        showLoading(false);
                        return { success: true, response: textResponse };
                    } else {
                        throw new Error("æ— æ•ˆçš„ API å“åº”ç»“æ„");
                    }
                } catch (error) {
                    console.error('Gemini API è°ƒç”¨å¤±è´¥:', error);
                    showLoading(false);
                    return { success: false, error: error.message };
                }
            }

            // --- äº‹ä»¶ç›‘å¬å™¨ ---

            // 1. ç”Ÿæˆå›¢é˜Ÿå‘¨æŠ¥
            generateMemoBtn.addEventListener('click', async () => {
                const conclusionEl = document.getElementById('coreConclusions');
                const problemText = (conclusionEl) ? (conclusionEl.innerText || conclusionEl.textContent) : "æ ¸å¿ƒç»“è®ºæœªæ‰¾åˆ°ã€‚";
                
                const systemPrompt = "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„çŒªåœºåœºé•¿ã€‚æ ¹æ®ä»¥ä¸‹è¿™ä»½ç”Ÿäº§æŠ¥å‘Šçš„æ ¸å¿ƒç»“è®ºï¼Œç»™äº§æˆ¿å›¢é˜Ÿèµ·è‰ä¸€ä»½ç®€çŸ­ã€æœ‰åŠ›ã€é‡ç‚¹çªå‡ºçš„å‘¨æŠ¥å¤‡å¿˜å½•ã€‚å¤‡å¿˜å½•éœ€è¦ï¼š1. è‚¯å®šå›¢é˜Ÿåœ¨é«˜äº§ä»”æ•°ä¸Šçš„åŠªåŠ›ã€‚2. ä¸¥è‚ƒæŒ‡å‡ºä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜ï¼ˆé«˜èƒæ¬¡æ­»äº¡ç‡å’Œä½æ–­å¥¶å‡é‡ï¼‰ã€‚3. æå‡º 3-4 ä¸ªæœ¬å‘¨å¿…é¡»æ‰§è¡Œçš„ã€æœ€å…³é”®çš„è¡ŒåŠ¨ç‚¹ã€‚";
                const userQuery = `æŠ¥å‘Šç»“è®ºæ‘˜è¦å¦‚ä¸‹ï¼š\n\n${problemText}`;

                const result = await callGeminiAPI(userQuery, systemPrompt, false);

                if (result.success) {
                    const formattedContent = result.response.replace(/\n/g, '<br>');
                    showModal("âœ¨ æ™ºèƒ½å›¢é˜Ÿå‘¨æŠ¥ (è‰ç¨¿)", formattedContent);
                } else {
                    showModal("ç”Ÿæˆå¤±è´¥", `<p class="text-red-600">æ— æ³•è¿æ¥åˆ° AI æœåŠ¡ï¼Œè¯·ç¨åé‡è¯•ã€‚</p><p class="text-sm mt-2">é”™è¯¯: ${result.error}</p>`);
                }
            });

            // 2. åˆ†æè¥å…»æ–¹æ¡ˆ
            generateNutritionBtn.addEventListener('click', async () => {
                const problemText = "æ ¸å¿ƒé—®é¢˜ï¼šèƒæ¬¡ 3 çš„æ¯çŒªé¥²å–‚æ—¶é—´æœ€é•¿ï¼ˆ30.5å¤©ï¼‰ï¼Œä½†äº§å‡ºçš„ä»”çŒªå‡é‡å´æ˜¯æœ€ä½çš„ï¼ˆ6.84 kgï¼‰ï¼Œæ˜¾è‘—ä½äºèƒæ¬¡ 1ï¼ˆ24å¤©æ–­å¥¶ï¼Œ9.46 kgï¼‰ã€‚";
                
                const systemPrompt = "ä½ æ˜¯ä¸€ä½é¡¶çº§çš„çŒªåªè¥å…»ä¸“å®¶ã€‚ä¸€ä¸ªçŒªåœºé‡åˆ°äº†ä»¥ä¸‹é—®é¢˜ï¼Œè¯·æ ¹æ®è¿™ä¸ªé—®é¢˜ï¼Œæä¾›ä¸€ä¸ªç»“æ„åŒ–çš„è¥å…»å’Œç®¡ç†è°ƒæ•´æ–¹æ¡ˆã€‚è¯·ä¸¥æ ¼æŒ‰ç…§æä¾›çš„ JSON æ ¼å¼è¾“å‡ºã€‚";
                
                const result = await callGeminiAPI(problemText, systemPrompt, true, nutritionSchema);

                if (result.success) {
                    try {
                        const data = JSON.parse(result.response);
                        // å°† JSON æ ¼å¼åŒ–ä¸º HTML
                        let htmlContent = `
                            <p class="mb-4 text-sm bg-gray-100 p-3 rounded-md">åŸºäºâ€œèƒæ¬¡3æ¯çŒªæ³Œä¹³åæœŸä»”çŒªå‡é‡ä½â€çš„é—®é¢˜ï¼ŒAI å»ºè®®å¦‚ä¸‹ï¼š</p>
                            <h4 class="text-md font-semibold text-emerald-700 mb-2">1. å…³é”®è¥å…»è°ƒæ•´å»ºè®®</h4>
                            <ul class="list-disc list-inside space-y-1 mb-4">
                                ${data.key_nutrient_adjustments.map(item => `<li class="ml-4">${item}</li>`).join('')}
                            </ul>
                            <h4 class="text-md font-semibold text-emerald-700 mb-2">2. é¥²å–‚ç­–ç•¥å»ºè®®</h4>
                            <ul class="list-disc list-inside space-y-1 mb-4">
                                ${data.feeding_strategy.map(item => `<li class="ml-4">${item}</li>`).join('')}
                            </ul>
                            <h4 class="text-md font-semibold text-emerald-700 mb-2">3. é¥®æ°´ç®¡ç†å»ºè®®</h4>
                            <ul class="list-disc list-inside space-y-1">
                                ${data.water_management.map(item => `<li class="ml-4">${item}</li>`).join('')}
                            </ul>
                        `;
                        showModal("âœ¨ AI è¥å…»æ–¹æ¡ˆåˆ†æ", htmlContent);
                    } catch (parseError) {
                        console.error("è§£æ JSON å¤±è´¥:", parseError);
                        showModal("åˆ†æå¤±è´¥", `<p class="text-red-600">AI è¿”å›äº†æ— æ•ˆçš„æ•°æ®æ ¼å¼ã€‚</p><p class="text-sm mt-2">åŸå§‹æ•°æ®: ${result.response}</p>`);
                    }
                } else {
                    showModal("ç”Ÿæˆå¤±è´¥", `<p class="text-red-600">æ— æ³•è¿æ¥åˆ° AI æœåŠ¡ï¼Œè¯·ç¨åé‡è¯•ã€‚</p><p class="text-sm mt-2">é”™è¯¯: ${result.error}</p>`);
                }
            });

            // Modal å…³é—­å’Œå¤åˆ¶æŒ‰é’®
            closeModalBtn.addEventListener('click', hideModal);
            copyModalBtn.addEventListener('click', copyToClipboard);
            // ç‚¹å‡» Modal å¤–éƒ¨ç°è‰²åŒºåŸŸå…³é—­
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    hideModal();
                }
            });

        })();
    </script>

</body>
</html>